中間試験Rails課題２　AND検索機能の実装
N + 1 問題については
@posts = posts.all.includes(:tags, user: :profile).order(created_at: :desc).page(params[:page]).per(10)
と記述することで、解消された。
中間テーブルを挟む場合、user: :profileという記述でincludesが適用される。

次に、検索結果を表示するsearch.html.erbへ画面が遷移しないという問題。
今日は、ほとんどこの問題解決に時間を費やした。
ついに技術面談を受け、ある程度はChatGPTを使っても良いとアドバイスを受けた。
ただ、ChatGPTが提示したコードを理解せずに、そのまま使用するのはNGとのことであった。
デバックツールを使用すると、posts_controllerのsearchアクションに値が届いていないことが判明した。
検索フォームをデバックすると
Ransack::Search<
class: Post,
base: Grouping <
conditions: [
Condition <attributes: ["title", "body"], predicate: cont,combinator:or:values: [テスト"]>,
Condition <attributes: ["comments_body"], predicate: cont, values: ["テスト"]>,
Condition <attributes: ["profile_name"], predicate: cont, values: ["やっさん"]>
],
combinator: and
という結果であり、値が格納されていることを確認した。
さらに検索フォームのデバックを行い
(byebug) url
"/posts/search"
と、urlに次のパスを受け取っていることが判明した。
ルーティングについても
search_posts_path	GET	/posts/search(.:format)     posts#search
というルーティングが生成されており、問題はなかった。
では、なぜ画面遷移が起こらないのか。
原因は、ヘッダーの記述が問題であった。

<form class="d-flex">
  <li class="nav-item">
    <%= render 'shared/search_form',url: search_posts_path %>
  </li>
</form>

この記述では<form></form>の中に、<%= render 'shared/search_form',url: search_posts_path %>と記述している。
これでは、formが二重構造となり、ブラウザがルートパスへ強制修正してしまう。
よって<form>タグを削除し

<li class="nav-item">
  <%= render 'shared/search_form',url: search_posts_path %>
</li>

とすると、想定していた通りの画面遷移が起こり、検索結果が表示された。
よって、中間試験Rails課題２AND検索の実装は完了した。

明日は、Net::HTTPResponseについて調査し、使用方法を学ぶ。