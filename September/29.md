本日は、Rails応用の課題４のLGTMをもらえた。
本日の学習は
　１　fatControllerの解消
　２　rakeタスクの実装
　３　wheneverの実装
　４　Rails課題５のコードリーディング
となった。

１　fatControllerの解消
Lintチェックにおいて
「ConditionalAssignment: Use the return of the conditional for variable assignment and comparison.」
というエラーが出た。
（DeepLによる翻訳：条件付き代入: 変数代入や比較には条件式の戻り値を使用する。）
意味がわからないので、google検索をすると技術記事には

エラー対処法
```
# bad
if foo
  bar = 1
else
  bar = 2
end

# good
bar = if foo
        1
      else
        2
      end
```

と記載されていた。（根本的な理由は記載されていない）
ChatGPTの解説によると（抜粋）
•	Rubyの if は「式」＝ 値を返す
•	代入が if の中に2回出てくるのは冗長 → 一度だけ書いた方がキレイ
•	Lint は「読みやすく」「エラーを減らす」ためにこういう書き方を推奨してる
とのこと。

さらにLintチェックにおいて
「ConditionalAssignment: Use the return of the conditional for variable assignment and comparison.」
というエラーが出た。
これは、意味がわからないので、ググると、記事には`if` や `case`などによる分岐処理が増えると、複雑度としてカウントされる。とのことであった。
これは、ビジネスロジックをmodelに退避させることで、解消できた。

２　rakeタスクについて
技術記事には
```
# lib/tasks/herro.rake
namespace :hello do
  task :world => :environment do
    hw = HelloWorld.new
    puts hw.hoge
  end
end
```
と書いており、この通りに実装すれば可能。

３　wheneverについて
これも技術記事に書いている通りに実装した。

```
# Rails.rootを使用するために必要
require File.expand_path(File.dirname(__FILE__) + '/environment')

# cronを実行する環境変数
rails_env = ENV['RAILS_ENV'] || :development

# cronを実行する環境変数をセット
set :environment, rails_env

# cronのログの吐き出し場所
set :output, "#{Rails.root}/log/cron.log"

#定期実行したい処理を記入
every :hour do
  rake 'article_state:update_article_state'
end
```

そして、crontabコマンドを実行しなくては、ならないらしい。
```
# wheneverの設定更新
$ bundle exec whenever --update-crontab

# 設定内容にエラーがないか確認
$ bundle exec whenever

# 設定されているcronを見る
$ crontab -l

# crontabの設定削除（定期実行を辞めたいとき）
$ bundle exec whenever --clear-crontab
```
実行すると、このようになる。
```
yasaka@Yasaka-Mac 88765_Yasaka0601_runteq_curriculum_advanced % docker exec -it b3ea81ceac33 /bin/bash
root@b3ea81ceac33:/v3_advanced_rails# bundle exec whenever --update-crontab
[write] crontab file updated
root@b3ea81ceac33:/v3_advanced_rails# crontab -l


# Begin Whenever generated tasks for: /v3_advanced_rails/config/schedule.rb at: 2025-09-29 13:15:39 +0900
0 * * * * /bin/bash -l -c 'cd /v3_advanced_rails && RAILS_ENV=development bundle exec rake article_state:update_article_state --silent >> /v3_advanced_rails/log/cron.log 2>&1'

# End Whenever generated tasks for: /v3_advanced_rails/config/schedule.rb at: 2025-09-29 13:15:39 +0900
root@b3ea81ceac33:/v3_advanced_rails# service cron start
Starting periodic command scheduler: cron.
root@b3ea81ceac33:/v3_advanced_rails# exit
exit
```

明日は、Rails課題５を終わらせたい。
実装のイメージはついている。
ただ、検索条件をまとめる方法を調査する必要がある。
