本日も、Rails応用に取り組んだ。
まず、アプリの構造について理解しないと、先に進めないと考えた。
よって、まず、データ構造について、ロボらんてくんに壁打ちした。
今回のアプリは、ポリモーフィック関連を使用したデータ構造となっている。
まだ、深く理解していないので、言語化があまり出来ないが、説明すると、画像のメタデータなどの情報を一つのテーブルに記録する。
そして中間テーブルは、画像データが、どこに対応付けられているのか結びつけている。
例えば、Userのプロフィール画像であったり、ブログ記事のブロックであったり、ブログ記事のアイキャッチなどに、対応付ける。
```
中間テーブル
| article_id | blockable_type | blockable_id |
|------------|----------------|--------------|
| 1          | Sentence       | 10           |
| 1          | Medium         | 5            |
| 1          | Embed          | 3            |
```
例えば、このようなテーブル設計になっていれば、blockable_typeには、対応付けられているモデルが記載されている。
そしてblockable_idで探索する。
```
# ArticleBlockモデルで
article_block = ArticleBlock.first

# polymorphic: trueにより、以下が自動的に判断される：
# blockable_type = "Sentence" なら → Sentenceモデルを参照
# blockable_id = 10 なら → Sentence.find(10) を実行

article_block.blockable  # → 該当するSentence, Medium, Embedのいずれかを返す
```
言語化が、なかなか難しい。
そもそも、あまり腹落ちしていない知識なので、説明がおぼつかない。

また、アソシエーションには、このように記載する必要がある
```
belongs_to :blockable, polymorphic: true
```
これは、blockableのcolumnに複数のモデルに属することができる性質を付与している。
この記述により、blockableメソッドがRails内部で自動生成される。
blockableメソッドは、属するオブジェクトを返すが、そのロジックは、分からない。
その点をロボらんてくんに深掘りすると「今は、このくらいの理解で先に進むことができるから、先に進め」と言われた。
おそらく、Rails内部の話になるので、難易度が高いのだろう。
（メタプログラミング？というらしい）

明日は、publishes_controller.rbのupdateアクションについて、さらに理解を深めたい。
時刻に関するロジックを組み込む必要があるようだ。
今日は、体調が良くないので、夜の学習はせず、早く就寝する。

