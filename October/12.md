１１日は、唐突に関西もくもく会に参加した。
やはり、オフのもくもく会は、学習の場というより、情報交換、交流の場である。
さらに、終電を逃し、午前４時頃まで起きていた。
つまり、１１日と１２日は、ほぼ学習していない。
よって、今日のToday I Learnedは、ActiveRecord演習（とSQL）で学習した内容を記述する。

本課題は、sakilaのサンプルデータを使用している。
まだ、１０問中、３問までしか出来ていない。
まず、１問目で学んだことは、必ずしも　SELECT ＊　が正しいとは限らないということだ。

１問目の問題は　クライアント 『IDが2の店舗に所属するスタッフって誰だっけ？』　というものだ

久しぶりにSQLを触ると、手が動かない。
とりあえず、セオリーである

SELECT *
FROM staff;

のように、全て出力してから、絞り込み条件を考えようとした。

だが、エラーとなり、　--------　と線が何行にも渡って出力され、文字化けする出力となった。
その原因は、staffテーブルが持つcolumnにあった。
pictureというcolumnを持ち、データ型はblob型であることがエラーの原因だった。
具体的に説明すると、blob型は、バイナリデータを格納するデータ型であり、バイナリデータとは画像、音声、動画などコンピューターが0と1で処理するデータとのこと。
つまり、blob型は、テキストで出力することができず、その結果、上記のような出力結果となる。
ActiveRecordは、「モデル名.条件など」と記述し、　.  でチェーンする。
一問目の回答は
```
SQL
SELECT *
FROM staff
WHERE staff.store_id = 2;

ActiveRecord
Staff.where(store_id:2)
```

２問目の問題は　クライアント 『映画「BLANKET BEVERLY」のDVD、いくつ在庫あるっけ？』
ここでは、JOINが必要となる。
inventoryテーブルの１行は、DVD１枚を示している点に気づく必要がある。
回答は
```
SQL
SELECT COUNT(*)
FROM inventory
JOIN film
ON inventory.film_id = film.film_id
WHERE film.title = 'BLANKET BEVERLY';

ActiveRecord
Film.find_by(title: 'BLANKET BEVERLY').inventories.size
もしくは
Inventory.joins(:film).where(film: { title: 'BLANKET BEVERLY'}).size
```
である。
ここで気を付けるべきアソシエーションである。
joinsのテーブル名は、アソシエーションで関連づけをしたものと同一にしなければならない。
つまり、単数系であるのか複数形であるのかである。

３問目は　クライアント 『2005年に貸し出ししてるけどまだ返却されてない映画があるらしい。その映画の一覧を出して！』

この問題は、中間テーブルをJOINする必要がある。

```
SQL
SELECT film.film_id,title
FROM film
JOIN inventory
ON inventory.film_id = film_id
JOIN rental
ON rental.inventory_id = inventory.inventory_id
WHERE rental.rental_date BETWEEN '2005-01-01' AND '2005-12-31'
AND rental.return_date IS NULL;

ActiveRecord
Film.joins(inventories: :rentals).where(rentals: { rental_date: '2005-01-01'..'2005-12-31' }).where(rentals: { return_date: nil}).select('film_id'.'title')
```
ここで注目すべき点は、中間テーブルのjoinsの方法だ。
::を使用することとなる。

明日は、アウトプット会の登壇資料を作成しなければならない。
１１月に２つの登壇がある。