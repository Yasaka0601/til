Rails応用の課題９に取り組んだ。
ポリモーフィック関連は難しい。
本日は、Active Storageについて調査した。
まず、faviconとop_imageの削除の方法について。
初め、自分はsiteのルーティングにdestroyを追加し、siteのコントローラーにdestroyアクションを追加すれば良いと考えていた。
しかし、今回の課題は、ポリモーフィック関連が使用されており、Active Storageを使用した実装をする必要があった。
なんと、destroyだけコントローラーを分ける必要があるとのこと。
そうすれば、faviconやop_image、main_imageの削除を一つのコントローラーで行うことが可能とのこと。
なるほど、かなり便利である。
しかし、どのようにルーティングを定義するのか分からなかった。
AIによると（頼らざるを得なかった）ルーティングをネスト構造にするとのこと。
```
resource :site, only: %i[edit update] do
  resources :attachments, controller: 'site/attachments', only: %i[destroy]
end
```
ルーティングをネストすることが出来るのは、初めて知った。
また、resourcesについても、単数系と複数形で、生成されるルーティングは異なる。
paramsでIDを取得する設計であれば、複数形にしなければならない。

次に、AttachmentsControllerを作成せよ、とのことで
```
class Admin::Site::AttachmentsController
```
を作成した。
そもそも、クラス名の命名規則を知らなかった。
これもAIによると
Admin:: → admin/ ディレクトリ
Site:: → site/ ディレクトリ
:: は「の中の」という意味
つまり「Admin の中の Site の中の AttachmentsController」という階層構造を表現しているんです。
と、階層構造を示しているとのことであった。

さらに、Active Storageは便利である。

通常なら、（自分もこの発想だった）IDでオブジェクトを特定する実装はこのようにする。
```
@site.favicon.purge if params[:status] == 'favicon'
@site.og_image.purge if params[:status] == 'og_image'
```
faviconなのか、og_imageなのかを条件分岐させるのだ。
しかし、Active Storageは、さらに便利で
```
ActiveStorage::Attachment.find(params[:id]).purge
```
これだけで、favicon、og_imageなのかを判別できるとのこと。

あとは、viewの実装だが、ここが一番苦手である。
記事を検索してみると、RUNTEQ卒業生による者の記事を発見した（多い）
構造は簡単で、linkを作成して、そのlinkを踏ませ、先ほど、ネストして作成したルーティングのパスへ導いて、メソッドをdeleteにすればいい。

明日の目標は、課題９を終わらせること。